<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Maps Place Ranker ‚Äî Setup</title>
  <meta name="description" content="Configure your Google Maps Place Ranker search parameters.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="logo">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        <span>Place Ranker</span>
      </div>
      <div class="stepper">
        <div class="step-dot active" data-step="0"><span>1</span><label>API Keys</label></div>
        <div class="step-line"></div>
        <div class="step-dot" data-step="1"><span>2</span><label>Search</label></div>
        <div class="step-line"></div>
        <div class="step-dot" data-step="2"><span>3</span><label>Location</label></div>
        <div class="step-line"></div>
        <div class="step-dot" data-step="3"><span>4</span><label>Finish</label></div>
      </div>
    </header>

    <main class="wizard-container">
      <!-- Step 1: API Keys -->
      <section class="wizard-step active" id="step-0">
        <div class="card">
          <div class="card-icon">üîë</div>
          <h1>API Keys</h1>
          <p class="card-subtitle">Enter your Google Cloud and Gemini API keys to get started.</p>

          <div class="form-group">
            <label for="google-maps-key">Google Maps API Key <span class="required">*</span></label>
            <input type="password" id="google-maps-key" placeholder="AIza..." autocomplete="off">
            <small>Requires <strong>Places API (New)</strong> and <strong>Routes API</strong> enabled.</small>
          </div>

          <div class="form-group">
            <label for="gemini-key">Gemini API Key <span class="required">*</span></label>
            <input type="password" id="gemini-key" placeholder="AIza..." autocomplete="off">
            <small>Used to generate optimized search terms for your query.</small>
          </div>

          <div class="form-group toggle-group">
            <label class="toggle-label">
              <input type="checkbox" id="show-keys">
              <span>Show keys</span>
            </label>
          </div>

          <div class="btn-row">
            <div></div>
            <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
          </div>
        </div>
      </section>

      <!-- Step 2: What are you looking for? -->
      <section class="wizard-step" id="step-1">
        <div class="card">
          <div class="card-icon">üîç</div>
          <h1>What are you looking for?</h1>
          <p class="card-subtitle">Describe the type of place you want to rank. Gemini will generate optimized search terms.</p>

          <div class="form-group">
            <label for="search-description">Describe what you want to find <span class="required">*</span></label>
            <input type="text" id="search-description" placeholder='e.g. "best barbershop", "sushi restaurant", "orthodontist"'>
          </div>

          <button class="btn btn-accent" id="generate-btn" onclick="generateSearchTerms()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            Generate with Gemini
          </button>

          <div id="generated-terms" class="generated-terms hidden">
            <div class="terms-section">
              <h3>Primary Search Queries</h3>
              <p class="terms-hint">Main search terms. These are used first.</p>
              <div id="primary-queries" class="tag-editor" data-field="primary"></div>
              <div class="tag-input-row">
                <input type="text" class="tag-input" id="add-primary" placeholder="Add query‚Ä¶">
                <button class="btn btn-sm" onclick="addTag('primary')">+</button>
              </div>
            </div>

            <div class="terms-section">
              <h3>Secondary Search Queries</h3>
              <p class="terms-hint">Used as fallback if primary queries find too few results.</p>
              <div id="secondary-queries" class="tag-editor" data-field="secondary"></div>
              <div class="tag-input-row">
                <input type="text" class="tag-input" id="add-secondary" placeholder="Add query‚Ä¶">
                <button class="btn btn-sm" onclick="addTag('secondary')">+</button>
              </div>
            </div>

            <div class="terms-section">
              <h3>Place Type Filters</h3>
              <p class="terms-hint">Google Maps place types to filter by.</p>
              <div id="type-filters" class="tag-editor" data-field="types"></div>
              <div class="tag-input-row">
                <input type="text" class="tag-input" id="add-types" placeholder="Add type‚Ä¶">
                <button class="btn btn-sm" onclick="addTag('types')">+</button>
              </div>
            </div>

            <details class="advanced-section">
              <summary>Advanced Filters</summary>
              <div class="terms-section">
                <h3>Reject Name Substrings</h3>
                <p class="terms-hint">Exclude places whose names contain these words.</p>
                <div id="reject-substrings" class="tag-editor" data-field="rejects"></div>
                <div class="tag-input-row">
                  <input type="text" class="tag-input" id="add-rejects" placeholder="Add substring‚Ä¶">
                  <button class="btn btn-sm" onclick="addTag('rejects')">+</button>
                </div>
              </div>
              <div class="form-group">
                <label for="min-reviews">Minimum Review Count</label>
                <input type="number" id="min-reviews" value="50" min="0" max="1000">
              </div>
            </details>
          </div>

          <div id="generate-error" class="error-msg hidden"></div>
          <div id="generate-spinner" class="spinner hidden">
            <div class="spinner-ring"></div>
            <span>Generating search terms with Gemini‚Ä¶</span>
          </div>

          <div class="btn-row">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
          </div>
        </div>
      </section>

      <!-- Step 3: Location -->
      <section class="wizard-step" id="step-2">
        <div class="card card-wide">
          <div class="card-icon">üìç</div>
          <h1>Choose Location</h1>
          <p class="card-subtitle">Select the center point for your search area.</p>

          <div class="location-modes">
            <button class="mode-btn active" onclick="setLocationMode('map')" data-mode="map">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
              Click on Map
            </button>
            <button class="mode-btn" onclick="setLocationMode('search')" data-mode="search">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
              Search Place
            </button>
            <button class="mode-btn" onclick="setLocationMode('manual')" data-mode="manual">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V4"/><path d="M4 12h16"/></svg>
              Enter Coordinates
            </button>
          </div>

          <div id="search-input-area" class="location-input hidden">
            <div class="form-group">
              <label for="place-search">Search for a place</label>
              <div class="search-row">
                <input type="text" id="place-search" placeholder="e.g. Warsaw, Poland">
                <button class="btn btn-sm btn-accent" onclick="searchPlace()">Search</button>
              </div>
              <div id="search-results" class="search-results hidden"></div>
            </div>
          </div>

          <div id="manual-input-area" class="location-input hidden">
            <div class="coord-row">
              <div class="form-group">
                <label for="manual-lat">Latitude</label>
                <input type="number" id="manual-lat" step="0.000001" placeholder="52.2297">
              </div>
              <div class="form-group">
                <label for="manual-lon">Longitude</label>
                <input type="number" id="manual-lon" step="0.000001" placeholder="21.0122">
              </div>
              <button class="btn btn-sm btn-accent coord-btn" onclick="applyManualCoords()">Set</button>
            </div>
          </div>

          <div id="map-container" class="map-container">
            <div id="map"></div>
          </div>

          <div id="selected-location" class="selected-location hidden">
            <span class="location-pin">üìå</span>
            <span id="location-display"></span>
          </div>

          <div class="btn-row">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary" onclick="nextStep()">Continue ‚Üí</button>
          </div>
        </div>
      </section>

      <!-- Step 4: Max Distance & Review -->
      <section class="wizard-step" id="step-3">
        <div class="card card-wide">
          <div class="card-icon">‚úÖ</div>
          <h1>Review & Generate</h1>
          <p class="card-subtitle">Set the search radius and review your configuration.</p>

          <div class="distance-control">
            <label for="max-distance">Maximum Distance: <strong id="distance-value">15</strong> km</label>
            <input type="range" id="max-distance" min="1" max="50" value="15" oninput="updateDistance(this.value)">
            <div class="range-labels"><span>1 km</span><span>25 km</span><span>50 km</span></div>
          </div>

          <div id="review-map-container" class="map-container map-small">
            <div id="review-map"></div>
          </div>

          <div class="review-summary" id="review-summary"></div>

          <div id="save-status" class="save-status hidden"></div>

          <div class="btn-row">
            <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
            <button class="btn btn-primary btn-finish" onclick="saveConfig()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>
              Generate Config
            </button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="app.js"></script>
</body>
</html>
